<html>

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <link rel="stylesheet" href="custom.css">
    <script src="const.js"></script>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.15/lodash.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

    <!-- <link rel="stylesheet" href="bootstrap-icons.css">
    <link rel="stylesheet" href="bootstrap.min.css">
    <script src="lodash.js"></script>
    <script src="jquery-3.6.0.min.js"></script>
    <script src="vue.js"></script> -->

    <title>ç‹¼äººæ®º ä¸»æŒäººæ•‘æ˜Ÿ</title>
</head>

<body>
    <div id="settingApp" class="day" style="overflow-x: hidden; background-color: rgb(47 47 47);">
        <div class="container-sm lock-mobile-width bg-color-2" style="min-height: 100%;">
            <div class="row">
                <div style="height: 35px;"></div>
                <div class="text-center flex-center" style="font-size: 1.5rem;">
                    ã€ç‹¼äººæ®º é¢æ®ºæ•‘æ˜ŸâœŠğŸ»ã€‘
                </div>
                <div class="col-1"></div>
                <div class="col-11 p-2" style="font-size: 0.7rem; color: #404040;">
                    é€™æ˜¯æä¾›ç‹¼äººæ®ºä¸»æŒäººå¯ä»¥<br>
                    <span class="under-line">æ–¹ä¾¿ç´€éŒ„</span> ä»¥åŠ
                    <span class="under-line">é¿å…å‡ºéŒ¯</span>çš„å°å¹«æ‰‹
                    <br> ä¹‹å¾Œæœƒæ¨å‡ºçµ¦ç©å®¶ä½¿ç”¨çš„<span class="under-line">ç©å®¶ç­†è¨˜</span>å°å¹«æ‰‹
                    <br>æ•¬è«‹æœŸå¾…ï½
                </div>
                <div style="height: 20px;"></div>

                <div class="container">
                    <div class="row">
                        <div class="row text-center flex-center">
                            <div class="col-6" style="font-size: 1.2rem;">éŠæˆ²äººæ•¸</div>
                            <div class="col-6 row">
                                <count-btn v-model="playerNum" :max="15" :min="6"></count-btn>
                            </div>
                        </div>
                        <div style="height: 10px;"></div>
                        <div style="height: 10px;"></div>

                        <div v-if="_.get(recommendedSetting,[playerNum], []).length > 0" class="row flex-center">
                            <div class="col-6" style="font-size: 1.2rem;">æ¨è–¦çµ„åˆï¼š</div>
                            <div class="col-6 row"></div>
                        </div>

                        <div v-for="(setting, index) in recommendedSetting[playerNum]" v-on:click="setChooseSet(index)">
                            <board class="board bg-color-1 p-2 m-2" :class="{'selected': chooseSet == index}" :setting="setting" :role-card="roleCard"></board>
                        </div>

                        <div class="row flex-center">
                            <div class="col-6" style="font-size: 1.2rem;">è‡ªè¨‚ï¼š</div>
                            <div class="col-6 row"></div>
                        </div>

                        <div v-on:click="setChooseSet('custom')">
                            <div class="board bg-color-1 p-2 m-2" :class="{'selected': chooseSet == 'custom'}">
                                <div class="row text-center flex-center">
                                    <div style="text-align: left;">ã€ç‹¼äººé™£ç‡Ÿã€‘</div>
                                    <div class="col-6">ç‹¼ç‹</div>
                                    <div class="col-6">
                                        <count-btn v-model="roleNum.werewolvesKing" :disable-add="disableAdd"></count-btn>
                                    </div>

                                    <div style="height: 10px;"></div>

                                    <div class="col-6">ç‹¼äºº</div>
                                    <div class="col-6">
                                        <count-btn v-model="roleNum.werewolves" :max="playerNum" :disable-add="disableAdd"></count-btn>
                                    </div>

                                    <div style="height: 10px;"></div>
                                    <div style="height: 10px;"></div>


                                    <!-- <div class="col-6">ç™½ç‹¼ç‹</div>
                                    <div class="col-6">
                                        é–‹ç™¼ä¸­æ•¬è«‹æœŸå¾…
                                    </div>

                                    <div class="col-6">ç‹¼ç¾äºº</div>
                                    <div class="col-6">
                                        é–‹ç™¼ä¸­æ•¬è«‹æœŸå¾…
                                    </div> -->
                                    <div style="height: 10px;"></div>


                                    <div style="text-align: left;">ã€å¥½äººé™£ç‡Ÿã€‘</div>
                                    <div class="col-6">é è¨€å®¶</div>
                                    <div class="col-6">
                                        <count-btn v-model="roleNum.seer" :disable-add="disableAdd"></count-btn>
                                    </div>

                                    <div style="height: 10px;"></div>


                                    <div class="col-6">å¥³å·«</div>
                                    <div class="col-6">
                                        <count-btn v-model="roleNum.witch" :disable-add="disableAdd"></count-btn>
                                    </div>
                                    <div class="col-2">

                                    </div>
                                    <div class="col-10">
                                        <div style="text-align: left;">
                                            <div>
                                                <input id="wR1" type="radio" v-model="witchRule" value="onlyFirst" :disabled="roleNum.witch == 0"><label for="wR1"><span style="font-size: 0.7rem;">&ensp;ç¬¬ä¸€æ™šå¯è‡ªæ•‘</span></label>
                                            </div>
                                            <div>
                                                <input id="wR2" type="radio" v-model="witchRule" value="canNot" :disabled="roleNum.witch == 0"><label for="wR2"><span style="font-size: 0.7rem;">&ensp;å…¨ç¨‹ä¸å¯è‡ªæ•‘</span></label>
                                            </div>
                                            <div>
                                                <input id="wR3" type="radio" v-model="witchRule" value="allCan" :disabled="roleNum.witch == 0"><label for="wR3"><span style="font-size: 0.7rem;">&ensp;å…¨ç¨‹å¯è‡ªæ•‘</span></label>
                                            </div>
                                        </div>
                                    </div>

                                    <div style="height: 10px;"></div>

                                    <div class="col-6">çµäºº</div>
                                    <div class="col-6">
                                        <count-btn v-model="roleNum.hunter" :disable-add="disableAdd"></count-btn>
                                    </div>

                                    <div style="height: 10px;"></div>

                                    <div class="col-6">é¨å£«</div>
                                    <div class="col-6">
                                        <count-btn v-model="roleNum.knight" :disable-add="disableAdd"></count-btn>
                                    </div>
                                    <div style="height: 10px;"></div>


                                    <!-- <div class="col-6">å®ˆè¡›</div>
                                    <div class="col-6">
                                        é–‹ç™¼ä¸­æ•¬å•ŸæœŸå¾…
                                    </div>

                                    <div class="col-6">é­”è¡“å¸«</div>
                                    <div class="col-6">
                                        é–‹ç™¼ä¸­æ•¬è«‹æœŸå¾…
                                    </div> -->

                                    <div class="col-6">å¹³æ°‘</div>
                                    <div class="col-6">
                                        {{villagers}}
                                    </div>
                                </div>

                                <br>
                                <div style="color: gray;">
                                    <input type="checkbox" disabled="true" v-model="hasSheriff">è­¦é•·ï¼ˆé–‹ç™¼ä¸­ï¼‰
                                    <br>
                                    <input type="radio" v-model="sheriffRule" value="1" :disabled="!hasSheriff"><span style="font-size: 0.7rem;">å–®çˆ†åè­¦å¾½</span>
                                    <br>
                                    <input type="radio" v-model="sheriffRule" value="2" :disabled="!hasSheriff"><span style="font-size: 0.7rem;">é›™çˆ†åè­¦å¾½</span>
                                </div>
                                <div style="height: 10px;"></div>

                                ã€ç²å‹æ¢ä»¶ã€‘
                                <br>
                                <input id="vC1" type="radio" v-model="victoryCon" value="killSide"><label for="vC1">å± é‚Š<span style="font-size: 0.7rem;">ï¼ˆç¥è·å…¨æ­» æˆ– å¹³æ°‘å…¨æ­»ï¼‰</span></label>
                                <br>
                                <input id="vC2" type="radio" v-model="victoryCon" value="killAll"><label for="vC2">å± åŸ<span style="font-size: 0.7rem;">ï¼ˆå¥½äººå…¨æ­»ï¼‰</span></label>
                            </div>
                        </div>
                        <div style="height: 60px;"></div>

                        <div class="submit-bar lock-mobile-width p-2">
                            <button class="btn-submit text-center btn-color-green" @click="submit">é–‹&ensp;å§‹</button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div id="app" v-if="isShow" :class="timeStatus" style="background-color: rgb(47 47 47);">
        <div class="header-bar text-center lock-mobile-width bg-color-2">
            <div class="container-sm">
                <transition name="slide-fade" mode="out-in">
                    <div v-if="hostMessage" :key="hostMessage" class="host-message text-center">
                        <div class="host-text-arrow"></div>
                        <div v-html="hostMessage"></div>
                    </div>
                    <div v-if="!hostMessage" style="height: 80px;"></div>
                </transition>
                <div class="judge-icon">
                    <i class="bi bi-person-fill"></i>
                </div>
                <div v-if="hostTips" :key="hostTips" class="host-tips text-center" v-html="hostTips">
                </div>
            </div>
        </div>
        <div class="function-bar lock-mobile-width bg-color-2">
            <div class="function-bar-wapper">
                <button v-for="btn in functionBarBtns" class="btn-color-green" v-show="btn.isShow" :class="btn.class" @click="btn.click" :disabled="btn.disable" v-html="btn.html"></button>
                <div style="width: 25px;"></div>
            </div>
            <!-- todo: fix animation -->
            <!-- <div id="maskNavBar" class="function-bar-mask"></div> -->
        </div>

        <div class="container-sm lock-mobile-width bg-color-1" style="min-height: 100%;">
            <div class="row">
                <!-- for Complement header height -->
                <div style="height: 210px;"></div>

                <div class="container">
                    <div class="row g-3">
                        <player-btn v-for="(player, index) in players" :player="player" :role-card="roleCard" :disable-btn="disableBtn" :kill-tag="tonight.killTag" v-model="selected"></player-btn>
                    </div>
                </div>
                <!-- for Complement bottom bar height -->
                <div style="height: 70px;"></div>
                <br>
            </div>
        </div>
        <div class="bottom-bar lock-mobile-width bg-color-2">
            <button class="next-btn btn-color-green" v-on:click="back()"><i class="bi bi-arrow-counterclockwise"></i>é‚„åŸ</button>
            <button class="next-btn btn-color-green" v-on:click="next()" :disabled="disableNext && selected.length == 0">ä¸‹ä¸€æ­¥ <i class="bi bi-arrow-right-circle-fill"></i></button>
        </div>
        <!-- ä½¿ç”¨è§£è—¥ -->
        <modal v-show="showModal == 'usedAntidote'" @close="showModal = false">
            <div slot="header">
                ä½¿ç”¨<span style="color: #1dd1a1;">è§£è—¥ï¼Ÿ</span>
            </div>
            <div slot="footer">
                <button class="modal-btn" v-on:click="witchSave(true)">æ˜¯</button>
                <button class="modal-btn" v-on:click="witchSave(false)">å¦</button>
            </div>
        </modal>
        <!-- ä½¿ç”¨æ¯’è—¥ -->
        <modal v-show="showModal == 'usedPoison'" @close="showModal = false">
            <div slot="header">
                ä½¿ç”¨<span style="color: #9b59b6;">æ¯’è—¥ï¼Ÿ</span>
            </div>
            <div slot="footer">
                <button class="modal-btn" v-on:click="poisonAsk(true)">æ˜¯</button>
                <button class="modal-btn" v-on:click="poisonAsk(false)">å¦</button>
            </div>
        </modal>
        <!-- é¨å£«å°æ±º -->
        <modal v-show="showModal == 'knightBattle'" @close="showModal = false">
            <div v-show="stage != 'speaking'" slot="header">é¨å£«æŸ¥é©—</div>
            <div v-show="stage == 'speaking'" slot="header">è«‹é¸æ“‡é¨å£«æŸ¥é©—å°è±¡</div>
            <div v-show="stage == 'speaking'" slot="body">
                <div v-for="(player, key) in players" class="col-4" style="display: inline-block;" v-on:click="function() { if(!player.isAlive || key == _.findKey(players, knightPlayer)) {return;} knightChoose = key; }">
                    <div class="modal-player-btn" :class="{'selected': knightChoose == key, 'disable': !player.isAlive || key == _.findKey(players, knightPlayer)}">
                        {{ key }}
                    </div>
                </div>
                <div style="height: 15px;"></div>
                <div style="background: linear-gradient(rgba(255, 255, 255, 0), rgb(255, 255, 255, 0.8), rgb(255, 255, 255, 0.97), rgb(255, 255, 255, 1));
                position: absolute;
                bottom: 77px;
                left: 0px;
                width: 100%;
                height: 30px;"></div>
            </div>
            <div v-show="stage != 'speaking'" slot="body" class="text-center">
                åƒ…èƒ½åœ¨ç™½å¤©ç™¼è¨€éšæ®µä½¿ç”¨ã€‚
            </div>
            <div v-show="stage == 'speaking'" slot="footer" class="text-center">
                <button class="modal-btn" v-on:click="knightBattle(knightChoose)">ç¢ºå®š</button>
                <button class="modal-btn" v-on:click="showModal = false">å–æ¶ˆ</button>
            </div>
            <div v-show="stage != 'speaking'" slot="footer" class="text-center">
                <button class="modal-btn" v-on:click="showModal = false">é—œé–‰</button>
            </div>
        </modal>
        <!-- ç‹¼äººè‡ªçˆ† -->
        <modal v-if="showModal == 'wolfKillSelf'" @close="showModal = false">
            <div v-show="stage != 'speaking'" slot="header">ç‹¼äººè‡ªçˆ†</div>
            <div v-show="stage == 'speaking'" slot="header">è«‹é¸æ“‡è‡ªçˆ†çš„ç‹¼äºº</div>
            <div v-show="stage == 'speaking'" slot="body">
                <div v-for="(player, key) in players" class="col-4" v-if="player.isAlive && _.get(roleCard, [player.identity, 'camp'], '') === 'bad'" style="display: inline-block;" v-on:click="wolfKillSelfChoose = key">
                    <div class="modal-player-btn" :class="{'selected': wolfKillSelfChoose == key}">
                        {{ key }}
                    </div>
                </div>
                <br>
            </div>
            <div v-show="stage != 'speaking'" slot="body" class="text-center">
                åƒ…èƒ½åœ¨ç™½å¤©ç™¼è¨€éšæ®µä½¿ç”¨ã€‚
            </div>
            <div v-show="stage == 'speaking'" slot="footer" class="text-center">
                <button class="modal-btn" v-on:click="wolfKillSelf(wolfKillSelfChoose)">ç¢ºå®š</button>
                <button class="modal-btn" v-on:click="showModal = false">å–æ¶ˆ</button>
            </div>
            <div v-show="stage != 'speaking'" slot="footer" class="text-center">
                <button class="modal-btn" v-on:click="showModal = false">é—œé–‰</button>
            </div>
        </modal>
        <!-- ç™¼è¨€é †åº -->
        <modal v-if="showModal == 'speakingModal'" @close="showModal = false">
            <div slot="header">èª°å…ˆç™¼è¨€ï¼Ÿ</div>
            <div slot="body">
                <div v-for="(player, key) in players" class="col-2" style="display: inline-block;" v-on:click="function() { if(!player.isAlive) {return;} today.firstSpeak = key; }">
                    <div class="modal-player-btn" style="width: 30px; height: 30px;" :class="{'selected': today.firstSpeak == key, 'disable': !player.isAlive}">
                        {{ key }}
                    </div>
                </div>
                <div class="row m-2">
                    <div class="col-6">
                        <div class="modal-player-btn" :class="{'selected': today.speakingDirection == 'right'}" style="width: 100%; height: 50px; border-radius: 50px;" @click="today.speakingDirection = 'right'">
                            é€†æ™‚é‡
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="modal-player-btn" :class="{'selected': today.speakingDirection == 'left'}" style="width: 100%; height: 50px; border-radius: 50px;" @click="today.speakingDirection = 'left'">
                            é †æ™‚é‡
                        </div>
                    </div>
                </div>
                <div style="height: 10px;"></div>
                <div style="background: linear-gradient(rgba(255, 255, 255, 0), rgb(255, 255, 255, 0.8), rgb(255, 255, 255, 0.97), rgb(255, 255, 255, 1));
                position: absolute;
                bottom: 77px;
                left: 0px;
                width: 100%;
                height: 30px;"></div>
            </div>
            <div slot="footer" class="text-center">
                <button id="randomBtn" class="modal-btn" :disabled="dicing" v-on:click="randomOrder()"><span v-html="dice"></span>&nbspæŠ½ç±¤</button>
                <button id="orderBtn" class="modal-btn" :disabled="!today.firstSpeak || !today.speakingDirection || dicing" v-on:click="next()">ç¢ºå®š</button>
            </div>
        </modal>

        <!-- éŠæˆ²çµæŸ -->
        <modal v-if="showModal == 'gameOver'" @close="showModal = false">
            <div slot="header">{{gameOverTitle}}</div>
            <div slot="body" class="text-center">
                å–œæ­¡é€™å€‹ç¨‹å¼å—ï¼Ÿ<br> æ˜¯å¦é¡˜æ„è´ŠåŠ©æˆ‘å€‘å–æ¯å’–å•¡ï¼Ÿ
            </div>
            <div slot="footer" class="flex-center">
                <a href=""></a>
                <a class="pay-img" href="https://www.jkopay.com/transfer?j=Transfer:900533530">
                </a>
            </div>
        </modal>
    </div>
</body>

</html>


<!-- template for the modal component -->
<script type="text/x-template" id="modal-template">
    <transition name="modal">
        <div class="modal-mask">
            <div class="modal-wrapper">
                <div class="modal-container">
                    <div class="modal-header-custom text-center p-1">
                        <slot name="header">
                            <!-- default header -->
                        </slot>
                    </div>
                    <div class="modal-body-custom p-1">
                        <slot name="body">
                            <!-- default body -->
                        </slot>
                    </div>
                    <div class="modal-footer-custom">
                        <slot name="footer">
                            <!-- default footer -->
                        </slot>
                    </div>
                </div>
            </div>
        </div>
    </transition>
</script>
<script>
    Vue.component("modal", {
        template: "#modal-template"
    });
</script>

<!-- template for count btn -->
<script type="text/x-template" id="countBtn">
    <div class="flex-center">
        <div class="col-4 p-0">
            <button class="count-btn btn-color-green" @click="subtract" :disabled="value <= min">
                <i class="bi bi-dash"></i>
            </button>
        </div>
        <div class="col-4 p-0">{{value}}</div>
        <div class="col-4 p-0">
            <button class="count-btn btn-color-green" @click="add" :disabled="value >= max || disableAdd">
                <i class="bi bi-plus"></i>
            </button>
        </div>
    </div>
</script>
<script>
    Vue.component("count-btn", {
        template: "#countBtn",
        props: {
            value: {
                type: Number,
                default: 12,
            },
            max: {
                type: Number,
                default: 1,
            },
            min: {
                type: Number,
                default: 0,
            },
            disableAdd: {
                type: Boolean,
                default: false,
            }
        },
        methods: {
            add: function() {
                this.$emit('input', this.value + 1);
            },
            subtract: function() {
                this.$emit('input', this.value - 1);
            }
        }
    });
</script>


<!-- template for board-template -->
<script type="text/x-template" id="board-template">
    <div class="">
        {{setting.title}}
        <div style="display: flex;">
            <div v-for="(num, role) in setting.roleNum" v-if="num > 0" style="display: contents;">
                <div class="role-dot-tag" :class="_.get(roleCard, [role, 'position'], '') + '-bg-color'">{{roleCard[role].shortName}}</div>
                <!-- <div v-for="i in (num-1)" class="role-dot-tag" :class="_.get(roleCard, [role, 'position'], '') + '-background-color'" style="margin-left: -20px;">{{roleCard[role].shortName}}</div> -->
                <div v-if="num >= 2" style="width: 20px;
                            display: flex;
                            place-content: center flex-start;
                            align-items: flex-end;
                            justify-content: flex-start;
                            align-content: center;">
                    <span style="font-size: 0.5rem;">x{{num}}</span>
                </div>
            </div>
        </div>
        <div style="height: 5px;"></div>
        <div v-if="showSheriffRule" class="rule-line">
            ãƒ»{{showSheriffRule}}
        </div>
        <div v-if="showWitchRule" class="rule-line">
            ãƒ»{{showWitchRule}}
        </div>
        <div v-if="showVictoryCon" class="rule-line">
            ãƒ»{{showVictoryCon}}
        </div>
    </div>
</script>
<script>
    Vue.component("board", {
        template: "#board-template",
        props: {
            'setting': {
                type: Object,
                default: function() {
                    return {};
                }
            },
            'roleCard': {
                type: Object,
                default: function() {
                    return {};
                }
            }
        },
        computed: {
            showSheriffRule: function() {
                if (!this.setting.hasSheriff) {
                    return 'ç„¡è­¦é•·';
                }
                var rule = {
                    '1': 'æœ‰è­¦é•·ï¼ˆå–®çˆ†åè­¦å¾½ï¼‰',
                    '2': 'æœ‰è­¦é•·ï¼ˆé›™çˆ†åè­¦å¾½ï¼‰',
                }

                return rule[_.get(this, ['setting', 'sheriffRule'], '2')];
            },
            showWitchRule: function() {
                if (this.setting.roleNum.witch <= 0) {
                    return '';
                }

                var result = '';
                switch (this.setting.witchRule) {
                    case WITCH_SELF_HELP_CON.ONLY_FIRST:
                        return 'å¥³å·«ç¬¬ä¸€æ™šå¯è‡ªæ•‘';
                    case WITCH_SELF_HELP_CON.CAN_NOT:
                        return 'å¥³å·«å…¨ç¨‹ä¸å¯è‡ªæ•‘';
                    case WITCH_SELF_HELP_CON.ALL_CAN:
                        return 'å¥³å·«å…¨ç¨‹å¯è‡ªæ•‘';
                    default:
                        break;
                }
                return '';
            },
            showVictoryCon: function() {
                return this.setting.victoryCon == VICTORY_CON.KILL_SIDE ? 'å± é‚Šå±€' : 'å± åŸå±€';
            }
        }
    });
</script>

<!-- template for the player button component -->
<script type="text/x-template" id="playerBtnTemp">
    <div class="player-btn-contanier text-center text-clould col-4" :class="{'animation': isAnimation, 'selected-btn': isSelected}" v-on:click="btnClick(player)">
        <div class="player-btn p-2" :class="{'selected': isSelected}">
            <div>
                <span class="number">{{ player.key }}</span><br>
                <span style="font-size: 0.8rem;">({{ player.name }})</span><br>
            </div>
        </div>
        <div v-if="!player.isAlive" class="death-tag p-2">
            <div></div>
        </div>
        <div v-if="!!_.get(this.killTag, [this.player.key], false)" class="kill-tag p-2">
            <div></div>
        </div>
        <div v-if="player.identity != ''" class="role-tag p-2">
            <div>
                <i class="bi bi-flag-fill" :class="_.get(roleCard, [player.identity, 'position'], '') + '-color'"></i>&nbsp{{ _.get(roleCard, [player.identity, 'text'], '')}}
            </div>
        </div>
    </div>
</script>
<script>
    Vue.component("player-btn", {
        template: "#playerBtnTemp",
        props: {
            value: {
                isRequired: true,
                default: [],
            },
            player: {
                isRequired: true,
            },
            roleCard: {
                isRequired: true,
            },
            disableBtn: {
                isRequired: true,
            },
            killTag: {
                isRequired: true,
            },
        },
        data: function() {
            return {
                isAnimation: false,
            };
        },
        computed: {
            isSelected: function() {
                return _.indexOf(this.value, this.player.key) >= 0;
            },
        },
        methods: {
            btnClick: function() {
                if (this.disableBtn || !this.player.isAlive) {
                    return;
                }

                this.isAnimation = true;
                setTimeout(() => {
                    this.isAnimation = false;
                }, 100);

                var selected = _.cloneDeep(this.value);

                if (this.isSelected) {
                    _.pull(selected, this.player.key)
                } else {
                    selected.push(this.player.key);
                }
                this.$emit('input', selected);
            },

        },
    });
</script>

<script>
    var roleNum = {
        'werewolvesKing': 1,
        'werewolves': 3,
        'seer': 1,
        'witch': 1,
        'hunter': 1,
        'knight': 1,
    }

    var temp = [];
    var logArr = [];

    var logLang = {
        'wolfKill': 'ç‹¼åˆ€æ®º',
        'witchKill': 'å¥³å·«æ¯’æ®º',
        'good': 'å¥½äºº',
        'bad': 'å£äºº',
    }

    var settingApp = new Vue({
        el: '#settingApp',
        data: {
            roleCard: roleCard,
            recommendedSetting: recommendedSetting,
            chooseSet: 0,
            playerNum: 12,
            roleNum: {
                'werewolvesKing': 1,
                'werewolves': 3,
                'seer': 1,
                'witch': 1,
                'hunter': 1,
                'knight': 1,
                'villagers': 4,
            },
            hasSheriff: false,
            sheriffRule: '',
            witchRule: WITCH_SELF_HELP_CON.ONLY_FIRST,
            victoryCon: VICTORY_CON.KILL_SIDE,
        },
        created: function() {
            window.onbeforeunload = function() {
                return false;
            }

            // ç¦æ­¢ç¸®æ”¾
            window.onload = () => {
                document.addEventListener('touchstart', (event) => {
                    if (event.touches.length > 1) {
                        event.preventDefault();
                    }
                }, {
                    passive: false
                });

                let lastTouchEnd = 0;
                document.addEventListener('touchend', (event) => {
                    const now = (new Date()).getTime();
                    if (now - lastTouchEnd <= 300) {
                        event.preventDefault();
                    }
                    lastTouchEnd = now;
                }, false);

                document.addEventListener('touchmove', function(event) {
                    event = event.originalEvent || event;
                    if (event.scale > 1) {
                        event.preventDefault();
                    }
                }, false);

                document.addEventListener('gesturestart', function(e) {
                    e.preventDefault();
                });
            }
        },
        watch: {
            playerNum: function(val) {
                var defaultData = _.get(this, ['recommendedSetting', val, 0], {});
                if (_.size(defaultData) <= 0) {
                    this.chooseSet = 'custom';
                    return;
                }
                this.chooseSet = '0';
                this.roleNum = defaultData.roleNum;
                this.hasSheriff = defaultData.hasSheriff;
                this.sheriffRule = defaultData.sheriffRule;
                this.witchRule = defaultData.witchRule;
                this.victoryCon = defaultData.victoryCon;
            }
        },
        methods: {
            updateData: function(name, value) {
                console.log(name);
                console.log(value);
                this[name] = value;
            },
            setChooseSet: function(index) {
                this.chooseSet = index;
            },
            submit: function() {
                if (this.chooseSet == 'custom') {
                    app.playerNum = _.cloneDeep(this.playerNum);
                    app.roleNum = _.cloneDeep(this.roleNum);
                    app.witchRule = _.cloneDeep(this.witchRule);
                    app.victoryCon = _.cloneDeep(this.victoryCon);
                } else {
                    var _this = this;
                    var chooseData = _.get(this, ['recommendedSetting', this.playerNum, this.chooseSet], {});

                    app.playerNum = _.cloneDeep(this.playerNum);
                    app.roleNum = _.cloneDeep(chooseData.roleNum);
                    app.witchRule = _.cloneDeep(chooseData.witchRule);
                    app.victoryCon = _.cloneDeep(chooseData.victoryCon);
                }

                $('#settingApp').hide();
                app.isShow = true;
                app.initPlayer();
            },
        },
        computed: {
            disableAdd: function() {
                var roleTotalNum = this.werewolvesKing +
                    this.werewolves +
                    this.seer +
                    this.witch +
                    this.hunter +
                    this.knight;

                return (roleTotalNum + 1) >= this.playerNum ? true : false;
            },
            villagers: function() {
                return this.playerNum - _.sum(_.values(_.reject(this.roleNum, function(o, key) {
                    return key == 'villagers';
                })));
            }
        }
    });


    var app = new Vue({
        el: '#app',
        data: {
            isShow: false,
            roleCard: roleCard,
            isSpeakingStage: false,
            stage: '',
            timeStatus: 'day',
            day: 1,
            hostMessage: 'ï¼ˆé€™è£¡æœƒé¡¯ç¤ºä½ è¦èªªçš„è©±ï¼‰',
            hostTips: 'æ„Ÿè¬ä½ é¡˜æ„ç•¶è¾›è‹¦çš„ä¸»æŒäºº<br>ï¼ˆè«‹æŒ‰å³ä¸‹è§’ã€ä¸‹ä¸€æ­¥ã€‘é–‹å§‹ï¼‰',
            actionNum: 0,
            selected: [],
            selectQuota: 0,
            selectAutoNext: false,
            disableBtn: true,
            disableNext: false,

            tonight: {
                killTag: {},
                killbyHunter: '',
                killbyWerewolvesKing: '',
                killedByWerewolves: '',
                killedByWitch: '',
                haveUsedAntidote: false,
                verifyTarget: '',
                verifyResult: '',
            },
            today: {
                killbyHunter: '',
                killbyWerewolvesKing: '',
                firstSpeak: '',
                speakIndex: 0,
                speakingDirection: '', // left: é †æ™‚é˜, right: é€†æ™‚é˜
                killedByVote: '',
                PKRoundNum: 0,
            },
            clickPKFlag: false,
            passSkillFlag: false,
            isUsedAntidote: false,
            isUsedPoison: false,
            tonightWitchSave: null,
            witchRule: WITCH_SELF_HELP_CON.ONLY_FIRST,

            tonightVerify: null,

            knightChoose: '',
            knightIsUsedSkill: false,

            wolfKillSelfChoose: '',

            showTimer: false,
            timer: 0,
            timerInterval: null,

            dice: '<i class="bi bi-dice-6-fill"></i>',
            dicing: false,

            showModal: '',
            gameOverTitle: '',

            playerNum: 0,
            players: {},
            roleNum: {
                'werewolvesKing': 0,
                'werewolves': 0,
                'seer': 0,
                'witch': 0,
                'hunter': 0,
                'knight': 0,
            },
            rolePlayerIndex: {
                'seer': 0,
                'witch': 0,
                'hunter': 0,
                'knight': 0,
            },

            victoryCon: VICTORY_CON.KILL_SIDE,
        },
        created: function() {
            temp.push(_.cloneDeep(this.$data));
        },
        mounted: function() {
            // todo: å„ªåŒ–ï¼Œä½¿ç”¨vue on scorll
            // var element = document.getElementsByClassName('function-bar')[0];
            // element.addEventListener("scroll", function(event) {
            //     var a = $(this).scrollLeft();
            //     var b = $(this).width();
            //     var c = $('.function-bar-wapper').width();
            //     if ((a + b + 50) > c) {
            //         $('#maskNavBar').hide();
            //     } else {
            //         $('#maskNavBar').show();
            //     }
            // }, false);

            // this.$nextTick(() => {
            //     testInit();
            // })
        },
        watch: {
            'selected': function(val, oldVal) {
                if (val.length == 0) {
                    return;
                }

                if (this.selected.length > this.selectQuota) {
                    this.selected = _.drop(this.selected);
                }

                if (val.length == this.selectQuota) {
                    if (this.selectAutoNext) {
                        this.next();
                    }
                }
            }
        },
        methods: {
            initPlayer: function() {
                for (var i = 1; i <= this.playerNum; i++) {
                    this.players[i] = {
                        'key': i,
                        'name': i + 'è™Ÿç©å®¶',
                        'identity': '',
                        'isAlive': true,
                    }
                }
            },
            next: function() {
                var backupData = _.cloneDeep(this.$data);
                var nowRunDown = this.runDown();

                if (typeof(nowRunDown.action) === 'function') {
                    try {
                        if (nowRunDown.action() === 'pass') {
                            this.actionNum += 1;
                            this.next();
                            return;
                        };
                    } catch (e) {
                        console.log('error at next: ', e);
                        return;
                    }
                }
                this.hostMessage = nowRunDown.messageHtml;
                this.hostTips = nowRunDown.tipsHtml;
                if (_.has(nowRunDown, ['modal'])) {
                    this.showModal = _.get(nowRunDown, ['modal'], false);
                }
                this.actionNum += 1;
                this.backup(backupData);
            },
            backup: function(backupData) {
                if (temp.length > 20) {
                    temp = _.drop(temp);
                }
                temp.push(backupData);
            },
            back: function() {
                if (temp.length <= 1) {
                    return;
                }

                var previousData = _.last(temp);
                temp.pop();
                _.forEach(this.$data, (value, key) => {
                    this.$data[key] = previousData[key]
                });
                this.selected = [];
                this.clickPKFlag = false;
                this.passSkillFlag = false;
            },
            pkRound: function() {
                this.clickPKFlag = true;
                this.next();
            },
            knightBattle: function(target) {
                if (this.knightIsUsedSkill) {
                    return;
                }
                var knightPlayerKey = _.findKey(this.players, this.knightPlayer);
                if (target == '' || target == this.knightPlayer || !this.players[target].isAlive) {
                    return;
                }
                this.showModal = false;
                var backupData = _.cloneDeep(this.$data);

                this.showTimer = false;
                var targetIdentity = _.get(this, ['players', target, 'identity'], '');
                var targetCamp = _.get(roleCard, [targetIdentity, 'camp'], '');
                if (targetCamp == 'bad') {
                    this.hostMessage = target + 'è™Ÿ æ˜¯ç‹¼äººï¼<br>æº–å‚™é€²å…¥é»‘å¤œ'
                    this.setIsAlive(target, false);
                    this.resetNightData();
                    this.resetDayData();
                    this.actionNum = 0;
                    this.day += 1;
                } else if (targetCamp == 'good') {
                    this.hostMessage = target + 'è™Ÿ ä¸æ˜¯ç‹¼äººï¼<br>' + knightPlayerKey + 'è™Ÿ é¨å£«ä»¥æ­»è¬ç½ª'
                    this.setIsAlive(knightPlayerKey, false);
                }
                this.knightIsUsedSkill = true;
                this.backup(backupData);
            },
            wolfKillSelf: function(target) {
                this.showModal = false;
                var backupData = _.cloneDeep(this.$data);

                if (this.players[target].identity == 'werewolvesKing') {
                    this.hostMessage = target + 'è™Ÿç‹¼äººè‡ªçˆ†<br>è«‹ä½¿ç”¨è§’è‰²æŠ€èƒ½';
                    this.disableBtn = false;
                    this.stage = 'usingSkill';
                    this.actionNum = 43;
                    this.setIsAlive(target, false);
                    this.backup(backupData);
                    return;
                } else {
                    this.hostMessage = target + 'è™Ÿç‹¼äººè‡ªçˆ†<br>ä¸­æ­¢æ‰€æœ‰ç™¼è¨€ç›´æ¥é€²å…¥é»‘å¤œ';
                }
                this.setIsAlive(target, false);
                this.resetNightData();
                this.resetDayData();
                this.actionNum = 0;
                this.day += 1;

                this.backup(backupData);
            },
            setSelectQuota: function(quota) {
                this.selectQuota = quota;
            },
            setIdentity: function(role) {
                try {
                    if (this.selected.length != this.selectQuota) {
                        throw 'æ•¸é‡ä¸å°';
                    }

                    _.forEach(this.selected, (key) => {
                        if (this.players[key].identity !== '') {
                            throw 'å·²ç¶“è¨­å®šè§’è‰²';
                        } else {
                            this.players[key].identity = role;
                        }
                    });

                    if (_.has(this.rolePlayerIndex, role)) {
                        this.rolePlayerIndex[role] = this.selected[0];
                    }

                    this.selected = [];
                } catch (e) {
                    console.log(e);
                    throw e;
                }
            },
            btnClick: function(index, player) {
                if (!player.isAlive) {
                    return;
                }
                $('#' + index).trigger('click');
            },
            isSelected: function(index) {
                return _.indexOf(this.selected, index) >= 0;
            },
            // killç›¸é—œ
            setKillTag: function(type = '', canPass = false) {
                try {
                    if (canPass && this.selected.length == 0) {
                        return;
                    }

                    if (this.selected.length != 1) {
                        throw 'æ•¸é‡ä¸å°';
                    }
                    if (type == '') {
                        throw 'Typeä¸å°';
                    }
                    this.tonight.killTag[this.selected[0]] = type;
                    this.selected = [];
                } catch (e) {
                    console.log(e);
                    throw e;
                }
            },
            executeKillTag: function() {
                _.forEach(this.tonight.killTag, (deadType, index) => {
                    if (typeof(this[deadType] === 'function')) {
                        this[deadType](index);
                    }
                });
            },
            setDefaultFirstSpeaker: function() {
                var death = _.keys(this.tonight.killTag);

                if (death.length == 0) {
                    return;
                }
                var first = _.toInteger(_.get(death, [0], 0)) + 1;
                var totalPlayers = _.size(this.players);

                for (var i = 0; i < totalPlayers; i++) {
                    var index = (first + i) % totalPlayers <= 0 ? (first + i) % totalPlayers + totalPlayers : (first + i) % totalPlayers;
                    if (this.players[index].isAlive == true) {
                        this.today.speakingDirection = 'left';
                        this.today.firstSpeak = index;
                        return;
                    }
                }
            },
            wolfKill: function(target) {
                try {
                    this.tonight.killedByWerewolves = target;
                    this.setIsAlive(target, false);
                } catch (e) {
                    console.log(e);
                    throw e;
                }
            },
            witchKill: function(target) {
                try {
                    this.tonight.killedByWitch = target;
                    this.isUsedPoison = true;
                    this.setIsAlive(target, false);
                } catch (e) {
                    console.log(e);
                    throw e;
                }
            },
            voteKill: function() {
                try {
                    if (this.selected.length != 1) {
                        throw 'æ•¸é‡ä¸å°';
                    }
                    this.today.killedByVote = this.selected[0];
                    this.setIsAlive(this.today.killedByVote, false);
                } catch (e) {
                    console.log(e);
                    throw e;
                }
            },
            hunterKill: function(time = 'night') {
                try {
                    if (this.selected.length != 1) {
                        throw 'æ•¸é‡ä¸å°';
                    }
                    if (time == 'night') {
                        this.tonight.killbyHunter = this.selected[0];
                    } else if (time == 'day') {
                        this.today.killbyHunter = this.selected[0];
                    }
                    this.setIsAlive(this.selected[0], false);
                } catch (e) {
                    console.log(e);
                    throw e;
                }
            },
            werewolvesKingKill: function(time = 'night') {
                try {
                    if (this.selected.length != 1) {
                        throw 'æ•¸é‡ä¸å°';
                    }
                    if (time == 'night') {
                        this.tonight.killbyWerewolvesKing = this.selected[0];
                    } else if (time == 'day') {
                        this.today.killbyWerewolvesKing = this.selected[0];
                    }
                    this.setIsAlive(this.selected[0], false);
                } catch (e) {
                    console.log(e);
                    throw e;
                }
            },
            witchSave: function(boolean) {
                this.tonight.haveUsedAntidote = boolean;
                this.next();
            },
            poisonAsk: function(boolean) {
                var backupData = _.cloneDeep(this.$data);
                if (boolean) {
                    this.showModal = false;
                    this.hostTips = 'ï¼ˆè«‹é»é¸æ¯’è—¥ä½¿ç”¨ç©å®¶ï¼‰';
                    this.backup(backupData);
                    return;
                }
                this.next();
            },
            randomOrder: function() {
                var direction = _.sample(['left', 'right']);
                var alivePlayers = _.map(_.filter(this.players, (player) => {
                    return player.isAlive;
                }), (player) => {
                    return player.key;
                });
                this.dicing = true;

                var diceArr = [
                    '<i class="bi bi-dice-1"></i>',
                    '<i class="bi bi-dice-2"></i>',
                    '<i class="bi bi-dice-3"></i>',
                    '<i class="bi bi-dice-4"></i>',
                    '<i class="bi bi-dice-5"></i>',
                    '<i class="bi bi-dice-6"></i>',
                    '<i class="bi bi-dice-1-fill"></i>',
                    '<i class="bi bi-dice-2-fill"></i>',
                    '<i class="bi bi-dice-3-fill"></i>',
                    '<i class="bi bi-dice-4-fill"></i>',
                    '<i class="bi bi-dice-5-fill"></i>',
                    '<i class="bi bi-dice-6-fill"></i>',
                ];

                var diceAnimation = setInterval(() => {
                    this.dice = _.sample(diceArr);
                    this.today.firstSpeak = _.sample(alivePlayers);
                    this.today.speakingDirection = _.sample(['left', 'right']);
                }, 50);

                setTimeout(() => {
                    clearInterval(diceAnimation);
                    this.disableNext = false;
                    this.dicing = false;
                    this.next();
                }, 1000);
            },
            seerVerify: function() {
                try {
                    if (this.selected.length != 1) {
                        throw 'æ•¸é‡ä¸å°';
                    }

                    this.tonight.verifyTarget = this.selected[0];
                    var target = this.selected[0];

                    var identity = _.get(this, ['players', target, 'identity'], false)
                    var camp = _.get(roleCard, [identity, 'camp'], false);

                    if (identity != '') {
                        this.tonight.verifyResult = camp
                    } else if (identity == false) {
                        this.tonight.verifyResult = 'good';
                    } else {
                        throw 'é©—è­‰ç™¼ç”ŸéŒ¯èª¤';
                    }
                } catch (e) {
                    console.log(e);
                    throw e;
                }
            },
            setCity: function() {
                _.forEach(this.players, (value, key) => {
                    if (this.players[key].identity == '') {
                        this.players[key].identity = 'villagers';
                    }
                });
            },
            setIsAlive: function(playerIndex, boolean) {
                this.players[playerIndex].isAlive = boolean;
                this.selected = [];
                this.judgingTheOutcome();
            },
            judgingTheOutcome: function() {
                var count = {
                    'wolves': 0,
                    'priesthood': 0,
                    'villagers': 0,
                }

                _.forEach(this.players, (player, key) => {
                    if (player.isAlive) {
                        count[_.get(roleCard, [player.identity, 'position'], false)] += 1;
                    }
                });

                if (count.wolves == 0) {
                    this.gameOverTitle = 'éŠæˆ²çµæŸ å¥½äººç²å‹';
                    this.showModal = 'gameOver';
                    this.disableNext = true;
                    return;
                }

                if (this.victoryCon == VICTORY_CON.KILL_SIDE &&
                    (count.priesthood == 0 || count.villagers == 0)) {
                    this.gameOverTitle = 'éŠæˆ²çµæŸ ç‹¼äººç²å‹';
                    this.showModal = 'gameOver';
                    this.disableNext = true;
                    return;
                }

                if (this.victoryCon == VICTORY_CON.KILL_ALL &&
                    (count.priesthood == 0 && count.villagers == 0)) {
                    this.gameOverTitle = 'éŠæˆ²çµæŸ ç‹¼äººç²å‹';
                    this.showModal = 'gameOver';
                    this.disableNext = true;
                    return;
                }
            },
            startTimer: function() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                }
                this.timer = 60;
                this.timerInterval = setInterval(() => {
                    this.timer -= 1;
                    if (this.timer <= 0) {
                        this.timer = 0;
                        clearInterval(this.timerInterval);
                        return;
                    }
                }, 1000);
            },
            stopTimer: function() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                }
            },
            resetNightData: function() {
                this.tonight = {
                    killTag: {},
                    killbyHunter: '',
                    killbyWerewolvesKing: '',
                    killedByWerewolves: '',
                    killedByWitch: '',
                    haveUsedAntidote: false,
                    verifyTarget: '',
                    verifyResult: '',
                };
            },
            resetDayData: function() {
                this.today = {
                    killbyHunter: '',
                    killbyWerewolvesKing: '',
                    firstSpeak: '',
                    speakIndex: 0,
                    speakingDirection: '', // left: é †æ™‚é˜, right: é€†æ™‚é˜
                    killedByVote: '',
                    PKRoundNum: 0,
                };
            },
            runDown: function() {
                var _this = this;
                var arr = [{
                        'messageHtml': 'æº–å‚™é€²å…¥ç¬¬' + _this.day + 'å¤œ',
                        'tipsHtml': '',
                        'action': function() {},
                    }, {
                        'messageHtml': 'å¤©é»‘è«‹é–‰çœ¼',
                        'tipsHtml': '',
                        'action': function() {
                            _this.stage = 'night';
                            _this.timeStatus = 'night';
                            _this.selectAutoNext = true;
                        }
                    }, {
                        'messageHtml': 'ç‹¼äººè«‹çœçœ¼<br>è«‹ç¢ºèªå½¼æ­¤èº«ä»½',
                        'tipsHtml': 'ï¼ˆè«‹é»é¸ç‹¼ç‹ç©å®¶ï¼‰',
                        'action': function() {
                            // æ²’æœ‰è¨­å®šç‹¼ç‹
                            if (_this.roleNum.werewolvesKing <= 0) {
                                return 'pass';
                            }
                            // åƒ…ç¬¬ä¸€å¤©éœ€è¦
                            if (_this.day > 1) {
                                return 'pass';
                            }

                            var quota = _.get(_this, ['roleNum', 'werewolvesKing'], 0);
                            if (quota <= 0) {
                                throw 'Set werewolvesKing error: quota <= 0';
                            }

                            _this.setSelectQuota(quota);
                            _this.disableBtn = false;
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            // åƒ…ç¬¬ä¸€å¤©éœ€è¦
                            if (_this.day > 1) {
                                return 'pass';
                            }
                            if (_this.roleNum.werewolvesKing > 0) {
                                _this.setIdentity('werewolvesKing');
                                this.messageHtml = 'ç‹¼äººè«‹çœçœ¼<br>è«‹ç¢ºèªå½¼æ­¤èº«ä»½'
                                this.tipsHtml = 'ï¼ˆè«‹é»é¸å…¶ä»–' + _this.roleNum.werewolves + 'åç‹¼äººç©å®¶ï¼‰';
                            } else {
                                this.messageHtml = 'ç‹¼äººè«‹çœçœ¼'
                                this.tipsHtml = 'ï¼ˆè«‹é»é¸' + _this.roleNum.werewolves + 'åç‹¼äººç©å®¶ï¼‰';
                            }

                            var quota = _.get(_this, ['roleNum', 'werewolves'], 0);
                            if (quota <= 0) {
                                throw 'Set werewolves error: quota <= 0';
                            }
                            _this.setSelectQuota(quota);
                            _this.disableBtn = false;
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': 'ï¼ˆè«‹é»é¸è¢«æ®ºå®³ç©å®¶ï¼‰',
                        'action': function() {
                            if (_this.day <= 1) {
                                this.messageHtml = 'ç‹¼äººè«‹æ®ºäºº';
                                _this.setIdentity('werewolves');
                            } else {
                                this.messageHtml = 'ç‹¼äººè«‹çœçœ¼<br>ç‹¼äººè«‹æ®ºäºº';
                            }
                            _this.disableBtn = false;
                            _this.setSelectQuota(1);
                            _this.selectAutoNext = false;
                        },
                    }, {
                        'messageHtml': 'ç‹¼äººè«‹é–‰çœ¼',
                        'tipsHtml': '',
                        'action': function() {
                            _this.setKillTag('wolfKill');
                            _this.disableBtn = true;
                        },
                    }, {
                        'messageHtml': 'å¥³å·«è«‹çœçœ¼',
                        'tipsHtml': '',
                        'action': function() {
                            // æ²’æœ‰è¨­å®šå¥³å·«
                            if (_this.roleNum.witch <= 0) {
                                return 'pass';
                            }

                            // åƒ…ç¬¬ä¸€å¤©éœ€è¦
                            if (_this.day <= 1) {
                                var quota = _.get(_this, ['roleNum', 'witch'], 0);
                                if (quota <= 0) {
                                    throw 'Set witch error: quota <= 0';
                                }
                                this.tipsHtml = 'ï¼ˆè«‹é»é¸å¥³å·«ç©å®¶ï¼‰';
                                _this.setSelectQuota(quota);
                                _this.disableBtn = false;
                                _this.selectAutoNext = true;
                            }
                        },
                    }, {
                        'messageHtml': 'ä»–æ­»äº†<br>è«‹å•ä½ è¦ä½¿ç”¨è§£è—¥å—ï¼Ÿ',
                        'tipsHtml': '',
                        'modal': '',
                        'action': function() {
                            // æ²’æœ‰è¨­å®šå¥³å·«
                            if (_this.roleNum.witch <= 0) {
                                return 'pass';
                            }

                            if (_this.day <= 1) {
                                _this.setIdentity('witch');
                            }

                            // å·²ä½¿ç”¨è§£è—¥
                            if (_this.isUsedAntidote) {
                                return 'pass';
                            }

                            var theDead = _.findKey(_this.tonight.killTag, (o) => {
                                return o != '';
                            });

                            var witchPlayerKey = _.findKey(_this.players, (player) => {
                                return player == _this.witchPlayer;
                            });

                            this.tipsHtml = 'ï¼ˆè«‹ç”¨æ‰‹å‹¢å‘ŠçŸ¥ ' + theDead + 'è™Ÿ æ­»äº¡ï¼‰';

                            if (theDead == witchPlayerKey) {
                                if (_this.witchRule == WITCH_SELF_HELP_CON.ONLY_FIRST && _this.day > 1) {
                                    this.tipsHtml += '<br><span style="font-size: 0.9rem;">ç¬¬ä¸€å¤œå¾Œä¸å¯è‡ªæ•‘</span>'
                                    return;
                                } else if (_this.witchRule == WITCH_SELF_HELP_CON.CAN_NOT) {
                                    this.tipsHtml += '<br><span style="font-size: 0.9rem;">ä¸å¯è‡ªæ•‘</span>'
                                    return;
                                }
                            }

                            if (_.get(_this, ['witchPlayer', 'isAlive'], false) == true) {
                                this.modal = 'usedAntidote';
                            } else {
                                this.tipsHtml = 'ï¼ˆå¿µå®Œå³å¯ï¼‰<br><span style="font-size: 0.9rem;">å¥³å·«å·²å‡ºå±€</span>';
                                _this.disableNext = false;
                                return;
                            }

                            _this.disableBtn = true;
                            _this.disableNext = true;
                        }
                    }, {
                        'messageHtml': 'è«‹å•ä½ è¦ä½¿ç”¨æ¯’è—¥å—ï¼Ÿ<br>ä½ è¦æ¯’èª°å‘¢ï¼Ÿ',
                        'tipsHtml': '',
                        'modal': '',
                        'action': function() {
                            _this.selectAutoNext = false;
                            // æ²’æœ‰è¨­å®šå¥³å·«
                            if (_this.roleNum.witch <= 0) {
                                return 'pass';
                            }

                            if (_this.tonight.haveUsedAntidote) {
                                _this.isUsedAntidote = true;
                                _this.tonight.killTag = {};
                            }

                            if (_.get(_this, ['witchPlayer', 'isAlive'], false) == false) {
                                this.tipsHtml = 'ï¼ˆå¿µå®Œå³å¯ï¼‰<br><span style="font-size: 0.9rem;">å¥³å·«å·²å‡ºå±€</span>';
                                _this.disableNext = false;
                                return;
                            }

                            if (_this.tonight.haveUsedAntidote) {
                                this.tipsHtml = 'ï¼ˆå¿µå®Œå³å¯ï¼‰<br><span style="font-size: 0.9rem;">ç„¡æ³•åŒä¸€å¤œä½¿ç”¨è§£è—¥æ¯’è—¥</span>';
                                _this.disableNext = false;
                                return;
                            }
                            if (_this.isUsedPoison) {
                                this.tipsHtml = 'ï¼ˆå¿µå®Œå³å¯ï¼‰<br><span style="font-size: 0.9rem;">å·²ç„¡æ¯’è—¥</span>';
                                _this.disableNext = false;
                                return;
                            }
                            this.modal = 'usedPoison';
                            this.tipsHtml = '';
                            _this.disableBtn = false;
                            _this.disableNext = true;
                            // (å¥³å·«å·²æ·˜æ±°ï¼Œå¿µå®Œå³å¯)
                        }
                    }, {
                        'messageHtml': 'å¥³å·«è«‹é–‰çœ¼',
                        'tipsHtml': '',
                        'modal': '',
                        'action': function() {
                            // æ²’æœ‰è¨­å®šå¥³å·«
                            if (_this.roleNum.witch <= 0) {
                                return 'pass';
                            }
                            _this.setKillTag('witchKill', true);
                            _this.disableBtn = true;
                            _this.disableNext = false;
                        }
                    }, {
                        'messageHtml': 'é è¨€å®¶è«‹çœçœ¼',
                        'tipsHtml': '',
                        'action': function() {
                            // æ²’æœ‰è¨­å®šé è¨€å®¶
                            if (_this.roleNum.seer <= 0) {
                                return 'pass';
                            }
                            // åƒ…ç¬¬ä¸€å¤©éœ€è¦
                            if (_this.day <= 1) {
                                var quota = _.get(_this, ['roleNum', 'seer'], 0);
                                if (quota <= 0) {
                                    throw 'Set seer error: quota <= 0';
                                }
                                this.tipsHtml = 'ï¼ˆè«‹é»é¸é è¨€å®¶ç©å®¶ï¼‰';
                                _this.setSelectQuota(quota);
                                _this.disableBtn = false;
                                _this.selectAutoNext = true;
                            }
                        },
                    }, {
                        'messageHtml': 'è«‹é¸æ“‡ä½ è¦æŸ¥é©—çš„å°è±¡',
                        'tipsHtml': 'ï¼ˆè«‹é»é¸è¢«æŸ¥é©—å°è±¡ï¼‰',
                        'action': function() {
                            // æ²’æœ‰è¨­å®šé è¨€å®¶
                            if (_this.roleNum.seer <= 0) {
                                return 'pass';
                            }
                            if (_this.day <= 1) {
                                _this.setIdentity('seer');
                            }
                            if (_.get(_this, ['seerPlayer', 'isAlive'], false) != true) {
                                this.tipsHtml = 'ï¼ˆå¿µå®Œå³å¯ï¼‰<br><span style="font-size: 0.9rem;">é è¨€å®¶å·²æ·˜æ±°</span>';
                                return;
                            }

                            _this.disableBtn = false;
                            _this.selectAutoNext = false;
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': 'ï¼ˆè«‹ç”¨æ‰‹å‹¢å‘ŠçŸ¥èº«ä»½ï¼‰',
                        'action': function() {
                            // æ²’æœ‰è¨­å®šé è¨€å®¶
                            if (_this.roleNum.seer <= 0) {
                                return 'pass';
                            }
                            if (_.get(_this, ['seerPlayer', 'isAlive'], false) != true) {
                                return 'pass';
                            }
                            _this.seerVerify();
                            this.messageHtml = _this.tonight.verifyResult === 'good' ?
                                '<i class="bi bi-hand-thumbs-up-fill"></i>' : '<i class="bi bi-hand-thumbs-down-fill"></i>';
                            _this.disableBtn = true;
                            logArr.push('é è¨€å®¶é©—è­‰' + _this.selected[0] + 'è™Ÿ' + logLang[_this.tonight.verifyResult]);
                            _this.selected = [];
                        }
                    }, {
                        'messageHtml': 'é è¨€å®¶è«‹é–‰çœ¼',
                        'tipsHtml': '',
                        'action': function() {
                            // æ²’æœ‰è¨­å®šé è¨€å®¶
                            if (_this.roleNum.seer <= 0) {
                                return 'pass';
                            }
                        }
                    }, {
                        'messageHtml': 'çµäººè«‹çœçœ¼',
                        'tipsHtml': 'ï¼ˆè«‹é»é¸çµäººç©å®¶ï¼‰',
                        'action': function() {
                            // æ²’æœ‰è¨­å®šçµäºº
                            if (_this.roleNum.hunter <= 0) {
                                return 'pass';
                            }
                            if (_this.day > 1) {
                                return 'pass';
                            }

                            // åƒ…ç¬¬ä¸€å¤©éœ€è¦
                            var quota = _.get(_this, ['roleNum', 'hunter'], 0);
                            if (quota <= 0) {
                                throw 'Set hunter error: quota <= 0';
                            }
                            _this.setSelectQuota(quota);
                            _this.disableBtn = false;
                            _this.selectAutoNext = true;
                        },
                    }, {
                        'messageHtml': 'çµäººè«‹é–‰çœ¼',
                        'tipsHtml': '',
                        'action': function() {
                            // æ²’æœ‰è¨­å®šçµäºº
                            if (_this.roleNum.hunter <= 0) {
                                return 'pass';
                            }
                            if (_this.day > 1) {
                                return 'pass';
                            }
                            _this.setIdentity('hunter');
                            _this.disableBtn = true;
                        },
                    }, {
                        'messageHtml': 'é¨å£«è«‹çœçœ¼',
                        'tipsHtml': 'ï¼ˆè«‹é»é¸é¨å£«ç©å®¶ï¼‰',
                        'action': function() {
                            // æ²’æœ‰è¨­å®šé¨å£«
                            if (_this.roleNum.knight <= 0) {
                                return 'pass';
                            }
                            if (_this.day > 1) {
                                return 'pass';
                            }
                            // åƒ…ç¬¬ä¸€å¤©éœ€è¦
                            var quota = _.get(_this, ['roleNum', 'knight'], 0);
                            if (quota <= 0) {
                                throw 'Set hunter error: quota <= 0';
                            }
                            _this.setSelectQuota(quota);
                            _this.disableBtn = false;
                        },
                    }, {
                        'messageHtml': 'é¨å£«è«‹é–‰çœ¼',
                        'tipsHtml': '',
                        'action': function() {
                            // æ²’æœ‰è¨­å®šé¨å£«
                            if (_this.roleNum.knight <= 0) {
                                return 'pass';
                            }
                            if (_this.day > 1) {
                                return 'pass';
                            }
                            _this.setIdentity('knight');
                            _this.disableBtn = true;
                        },
                    }, {
                        'messageHtml': 'å¤©äº®äº†',
                        'tipsHtml': '',
                        'action': function() {
                            if (_this.day <= 1) {
                                _this.setCity();
                            }
                            _this.selectAutoNext = false;
                            _this.timeStatus = 'day';
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            _this.executeKillTag();
                            _this.setDefaultFirstSpeaker();
                            _this.tonight.killTag = {};
                            if (_this.tonight.haveUsedAntidote) {
                                this.messageHtml = 'æ˜¨æ™šæ˜¯å¹³å®‰å¤œ';
                            } else {
                                this.messageHtml = 'æ˜¨æ™š ' + _.filter([
                                    _this.tonight.killedByWerewolves,
                                    _this.tonight.killedByWitch,
                                ], function(killed) {
                                    return killed !== '';
                                }).sort(function(a, b) {
                                    return a - b;
                                }).join('è™Ÿã€') + 'è™Ÿ ç©å®¶å‡ºå±€';
                            }

                        },
                    },
                    //å¤œæ™š ç‹¼åˆ€åˆ°çµäºº
                    {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            var theDead = _.get(_this, ['tonight', 'killedByWerewolves'], '');
                            if (theDead == '' || _.get(_this, ['players', theDead, 'identity']) !== 'hunter') {
                                return 'pass';
                            }
                            this.messageHtml = theDead + 'è™Ÿç©å®¶<br>è«‹ä½¿ç”¨è§’è‰²æŠ€èƒ½';
                            this.tipsHtml = 'ï¼ˆè«‹é»é¸æŠ€èƒ½ä½¿ç”¨å°è±¡ï¼‰';
                            _this.disableBtn = false;
                            _this.stage = 'usingSkill';
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            if (_this.passSkillFlag) {
                                _this.stage = 'day';
                                this.messageHtml = _.get(_this, ['tonight', 'killedByWerewolves'], '') + 'è™Ÿç©å®¶ä¸ä½¿ç”¨æŠ€èƒ½';
                                _this.passSkillFlag = false;
                                return;
                            }
                            var theDead = _.get(_this, ['tonight', 'killedByWerewolves'], '');
                            if (theDead == '' || _.get(_this, ['players', theDead, 'identity']) !== 'hunter') {
                                return 'pass';
                            }
                            this.messageHtml = _this.selected[0] + 'è™Ÿç©å®¶å‡ºå±€';
                            _this.hunterKill('night');
                            _this.stage = 'day';
                        },
                    },
                    // çµæ§æ®ºåˆ°ç‹¼ç‹case
                    {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            var theDead = _this.tonight.killbyHunter;
                            if (theDead == '' || _this.players[theDead].identity !== 'werewolvesKing') {
                                return 'pass'
                            }
                            this.messageHtml = theDead + 'è™Ÿç©å®¶<br>è«‹ä½¿ç”¨è§’è‰²æŠ€èƒ½';
                            this.tipsHtml = 'ï¼ˆè«‹é»é¸æŠ€èƒ½ä½¿ç”¨å°è±¡ï¼‰';
                            _this.disableBtn = false;
                            _this.stage = 'usingSkill';
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            if (_this.passSkillFlag) {
                                _this.stage = 'day';
                                this.messageHtml = _this.tonight.killbyHunter + 'è™Ÿç©å®¶ä¸ä½¿ç”¨æŠ€èƒ½';
                                _this.passSkillFlag = false;
                                return;
                            }
                            var theDead = _this.tonight.killbyHunter;
                            if (theDead == '' || _this.players[theDead].identity !== 'werewolvesKing') {
                                return 'pass'
                            }
                            this.messageHtml = _this.selected[0] + 'è™Ÿç©å®¶å‡ºå±€';
                            _this.werewolvesKingKill('day');
                            _this.stage = 'day';
                        },
                    },
                    // å¤œæ™š ç‹¼ç‹è‡ªåˆ€
                    {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            var theDead = _.get(_this, ['tonight', 'killedByWerewolves'], '');
                            if (theDead == '' || _.get(_this, ['players', theDead, 'identity']) !== 'werewolvesKing') {
                                return 'pass';
                            }
                            this.messageHtml = theDead + 'è™Ÿç©å®¶<br>è«‹ä½¿ç”¨è§’è‰²æŠ€èƒ½';
                            this.tipsHtml = 'ï¼ˆè«‹é»é¸æŠ€èƒ½ä½¿ç”¨å°è±¡ï¼‰';
                            _this.disableBtn = false;
                            _this.stage = 'usingSkill';
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            if (_this.passSkillFlag) {
                                _this.stage = 'day';
                                this.messageHtml = _.get(_this, ['tonight', 'killedByWerewolves'], '') + 'è™Ÿç©å®¶ä¸ä½¿ç”¨æŠ€èƒ½';
                                _this.passSkillFlag = false;
                                return;
                            }
                            var theDead = _.get(_this, ['tonight', 'killedByWerewolves'], '');
                            if (theDead == '' || _.get(_this, ['players', theDead, 'identity']) !== 'werewolvesKing') {
                                return 'pass';
                            }
                            this.messageHtml = _this.selected[0] + 'è™Ÿç©å®¶å‡ºå±€';
                            _this.werewolvesKingKill('night');
                            _this.stage = 'day';
                        },
                    },
                    // ç‹¼ç‹æ®ºåˆ°çµäºº case
                    {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            var theDead = _this.tonight.killbyWerewolvesKing;
                            if (theDead == '' || _this.players[theDead].identity !== 'hunter') {
                                return 'pass'
                            }
                            this.messageHtml = theDead + 'è™Ÿç©å®¶<br>è«‹ä½¿ç”¨è§’è‰²æŠ€èƒ½';
                            this.tipsHtml = 'ï¼ˆè«‹é»é¸æŠ€èƒ½ä½¿ç”¨å°è±¡ï¼‰';
                            _this.disableBtn = false;
                            _this.stage = 'usingSkill';
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            if (_this.passSkillFlag) {
                                _this.stage = 'day';
                                this.messageHtml = _this.tonight.killbyWerewolvesKing + 'è™Ÿç©å®¶ä¸ä½¿ç”¨æŠ€èƒ½';
                                _this.passSkillFlag = false;
                                return;
                            }
                            var theDead = _this.tonight.killbyWerewolvesKing;
                            if (theDead == '' || _this.players[theDead].identity !== 'hunter') {
                                return 'pass'
                            }
                            this.messageHtml = _this.selected[0] + 'è™Ÿç©å®¶å‡ºå±€';
                            _this.hunterKill('day');
                            _this.stage = 'day';
                        },
                    }, {
                        'messageHtml': 'è«‹ç™¼è¡¨éºè¨€',
                        'tipsHtml': '',
                        'action': function() {
                            if (_this.day > 1 || _this.tonight.haveUsedAntidote) {
                                return 'pass';
                            }
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': 'ï¼ˆæ±ºå®šç™¼è¨€é †åºï¼‰',
                        'modal': 'speakingModal',
                        'action': function() {
                            _this.disableBtn = true;
                            _this.disableNext = true;
                            _this.selected = [];
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            _this.stage = 'speaking';
                            _this.showModal = false;
                            _this.disableNext = false;
                            var totalPlayers = _.size(_this.players);
                            var direction = _this.today.speakingDirection == 'left' ? 'é †æ™‚é‡' : 'é€†æ™‚é‡';
                            var next = (_this.today.speakingDirection == 'left' ? (_this.today.firstSpeak + 1) : (_this.today.firstSpeak - 1));
                            this.messageHtml = 'ç”±' + _this.today.firstSpeak + 'è™Ÿç©å®¶é–‹å§‹ç™¼è¨€<br>å¾€' + direction + 'æ–¹å‘æ¥çºŒ';
                        },
                    }, {
                        'messageHtml': 'ç¾åœ¨æº–å‚™æŠ•ç¥¨',
                        'tipsHtml': '',
                        'action': function() {
                            _this.showTimer = false;
                        },
                    }, {
                        'messageHtml': '3ã€2ã€1 è«‹æŠ•ç¥¨',
                        'tipsHtml': 'ï¼ˆè«‹é»é¸é­æŠ•ç¥¨å‡ºå±€ç©å®¶ï¼‰',
                        'action': function() {
                            _this.disableBtn = false;
                            _this.stage = 'voting';
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            if (_this.clickPKFlag) {
                                _this.today.PKRoundNum += 1;
                                _this.clickPKFlag = false;
                            }
                            if (_this.today.PKRoundNum == 1) {
                                this.messageHtml = 'é€²è¡Œè¾¯è«–<br>è«‹å¹³ç¥¨å€™é¸äººä¾åºç™¼è¨€';
                                _this.disableBtn = false;
                                logArr.push('å¹³ç¥¨è¾¯è«–');
                                _this.stage = 'PKSpeaking';
                                return;
                            }
                            this.messageHtml = _this.selected[0] + 'è™Ÿç©å®¶å‡ºå±€';
                            _this.voteKill();
                            _this.stage = 'day';
                        },
                    },
                    // å¹³ç¥¨PK
                    {
                        'messageHtml': 'å†æ¬¡æº–å‚™æŠ•ç¥¨',
                        'tipsHtml': '',
                        'action': function() {
                            if (_this.today.PKRoundNum == 1) {
                                return;
                            }
                            return 'pass';
                        },
                    }, {
                        'messageHtml': '3ã€2ã€1 è«‹æŠ•ç¥¨',
                        'tipsHtml': 'ï¼ˆè«‹é»é¸é­æŠ•ç¥¨å‡ºå±€ç©å®¶ï¼‰',
                        'action': function() {
                            if (_this.today.PKRoundNum == 1) {
                                _this.disableBtn = false;
                                _this.stage = 'voting';
                                return;
                            }
                            return 'pass';
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            if (_this.clickPKFlag) {
                                _this.today.PKRoundNum += 1;
                                _this.clickPKFlag = false;
                            }
                            if (_this.today.PKRoundNum == 1) {
                                this.messageHtml = _this.selected[0] + 'è™Ÿç©å®¶å‡ºå±€';
                                _this.voteKill();
                                _this.stage = 'day';
                            } else {
                                return 'pass';
                            }
                        },
                    },
                    //ç¥¨åˆ°çµäººæˆ–ç‹¼ç‹ strat
                    {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            var theDead = _.get(_this, ['today', 'killedByVote'], '');
                            var theDeadIdentity = _.get(_this, ['players', theDead, 'identity'], '');

                            if (theDeadIdentity === 'hunter' ||
                                theDeadIdentity === 'werewolvesKing') {
                                this.messageHtml = theDead + 'è™Ÿç©å®¶<br>è«‹ä½¿ç”¨è§’è‰²æŠ€èƒ½';
                                this.tipsHtml = 'ï¼ˆè«‹é»é¸æŠ€èƒ½ä½¿ç”¨å°è±¡ï¼‰';
                                _this.disableBtn = false;
                                _this.stage = 'usingSkill';
                                return;
                            }
                            return 'pass';
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            if (_this.passSkillFlag) {
                                _this.stage = 'day';
                                this.messageHtml = _.get(_this, ['today', 'killedByVote'], '') + 'è™Ÿç©å®¶ä¸ä½¿ç”¨æŠ€èƒ½';
                                _this.passSkillFlag = false;
                                return;
                            }
                            var theDead = _.get(_this, ['today', 'killedByVote'], '');
                            var theDeadIdentity = _.get(_this, ['players', theDead, 'identity'], '');

                            this.messageHtml = _this.selected[0] + 'è™Ÿç©å®¶å‡ºå±€';
                            if (theDeadIdentity === 'hunter') {
                                _this.hunterKill('day');
                                _this.stage = 'day';
                                return;
                            } else if (theDeadIdentity === 'werewolvesKing') {
                                _this.werewolvesKingKill('day');
                                _this.stage = 'day';
                                return;
                            }
                            return 'pass';
                        },
                    }, {
                        //åˆæ®ºåˆ°ç‹¼ç‹æˆ–çµäººï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Šï¼Š
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            if (_this.today.killbyHunter != '') {
                                var theDead = _this.today.killbyHunter;
                                if (_.get(_this, ['players', theDead, 'identity'], '') === 'werewolvesKing') {
                                    this.messageHtml = theDead + 'è™Ÿç©å®¶<br>è«‹ä½¿ç”¨è§’è‰²æŠ€èƒ½';
                                    this.tipsHtml = 'ï¼ˆè«‹é»é¸æŠ€èƒ½ä½¿ç”¨å°è±¡ï¼‰';
                                    _this.disableBtn = false;
                                    _this.stage = 'usingSkill';
                                    return;
                                }
                            }
                            if (_this.today.killbyWerewolvesKing != '') {
                                var theDead = _this.today.killbyWerewolvesKing;
                                if (_.get(_this, ['players', theDead, 'identity'], '') === 'hunter') {
                                    this.messageHtml = theDead + 'è™Ÿç©å®¶<br>è«‹ä½¿ç”¨è§’è‰²æŠ€èƒ½';
                                    this.tipsHtml = 'ï¼ˆè«‹é»é¸æŠ€èƒ½ä½¿ç”¨å°è±¡ï¼‰';
                                    _this.disableBtn = false;
                                    _this.stage = 'usingSkill';
                                    return;
                                }
                            }
                            return 'pass';
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            if (_this.today.killbyHunter != '') {
                                var theDead = _this.today.killbyHunter;
                                if (_.get(_this, ['players', theDead, 'identity'], '') === 'werewolvesKing') {
                                    if (_this.passSkillFlag) {
                                        _this.stage = 'day';
                                        this.messageHtml = theDead + 'è™Ÿç©å®¶ä¸ä½¿ç”¨æŠ€èƒ½';
                                        _this.passSkillFlag = false;
                                        return;
                                    }

                                    this.messageHtml = _this.selected[0] + 'è™Ÿç©å®¶å‡ºå±€';
                                    _this.werewolvesKingKill('day');
                                    _this.stage = 'day';
                                    return;
                                }
                            }
                            if (_this.today.killbyWerewolvesKing != '') {
                                var theDead = _this.today.killbyWerewolvesKing;
                                if (_.get(_this, ['players', theDead, 'identity'], '') === 'hunter') {
                                    if (_this.passSkillFlag) {
                                        _this.stage = 'day';
                                        this.messageHtml = theDead + 'è™Ÿç©å®¶ä¸ä½¿ç”¨æŠ€èƒ½';
                                        _this.passSkillFlag = false;
                                        return;
                                    }

                                    this.messageHtml = _this.selected[0] + 'è™Ÿç©å®¶å‡ºå±€';
                                    _this.hunterKill('day');
                                    _this.stage = 'day';
                                    return;
                                }
                            }
                            return 'pass';
                        },
                    },
                    //ç¥¨åˆ°çµäººæˆ–ç‹¼ç‹ end
                    {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            if (_this.today.killedByVote == '' && _this.today.PKRoundNum == 2) {
                                this.messageHtml = 'å†æ¬¡å¹³ç¥¨ï¼Œé€²å…¥é»‘å¤œ'
                            } else {
                                this.messageHtml = 'è«‹ç™¼è¡¨éºè¨€'
                            }
                            _this.stage = 'day';
                            _this.disableBtn = true;
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            _this.actionNum = 0;
                            _this.day += 1;
                            _this.resetNightData();
                            _this.resetDayData();
                            return 'pass';
                        },
                    },

                    //ç‹¼ç‹è‡ªçˆ†å°ˆç”¨

                    {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            this.messageHtml = _this.selected[0] + 'è™Ÿç©å®¶å‡ºå±€<br>æ²’æœ‰éºè¨€';
                            _this.werewolvesKingKill('day');
                            _this.stage = 'day';
                        },
                    },
                    //çˆ†åˆ°çµäºº
                    {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            var theDead = _this.today.killbyWerewolvesKing;
                            if (theDead == '' || _this.players[theDead].identity !== 'hunter') {
                                return 'pass'
                            }
                            this.messageHtml = theDead + 'è™Ÿç©å®¶<br>è«‹ä½¿ç”¨è§’è‰²æŠ€èƒ½';
                            this.tipsHtml = 'ï¼ˆè«‹é»é¸æŠ€èƒ½ä½¿ç”¨å°è±¡ï¼‰';
                            _this.disableBtn = false;
                            _this.stage = 'usingSkill';
                            logArr.push(this.messageHtml);
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            if (_this.passSkillFlag) {
                                _this.stage = 'day';
                                this.messageHtml = _this.today.killbyWerewolvesKing + 'è™Ÿç©å®¶ä¸ä½¿ç”¨æŠ€èƒ½';
                                _this.passSkillFlag = false;
                                return;
                            }
                            var theDead = _this.today.killbyWerewolvesKing;
                            if (theDead == '' || _this.players[theDead].identity !== 'hunter') {
                                return 'pass'
                            }
                            this.messageHtml = _this.selected[0] + 'è™Ÿç©å®¶å‡ºå±€<br>æ²’æœ‰éºè¨€';
                            _this.hunterKill('day');
                            _this.stage = 'day';
                        },
                    }, {
                        'messageHtml': '',
                        'tipsHtml': '',
                        'action': function() {
                            _this.actionNum = 0;
                            _this.day += 1;
                            _this.resetNightData();
                            _this.resetDayData();
                            return 'pass';
                        },
                    },
                ];

                return arr[this.actionNum];
            },

        },
        computed: {
            knightBattleDisable: function() {
                // æœ‰bug
                return this.knightIsUsedSkill;
            },
            seerPlayer: function() {
                return this.players[this.rolePlayerIndex.seer];
            },
            //bug æ²’æ‹¿åˆ°çš„æ™‚å€™æœƒç”¨1è™Ÿå»æ“‹
            knightPlayer: function() {
                return this.players[this.rolePlayerIndex.knight];
            },
            witchPlayer: function() {
                return this.players[this.rolePlayerIndex.witch];
            },
            functionBarBtns: function() {
                var _this = this;
                return [{
                        class: 'function-btn',
                        click: () => {
                            _this.showModal = 'knightBattle';
                        },
                        disable: _this.knightBattleDisable,
                        html: 'é¨å£«æŸ¥é©—',
                        isShow: !(_this.stage == 'voting' || _this.stage == 'usingSkill')
                    },

                    {
                        class: 'function-btn',
                        click: () => {
                            _this.showModal = 'wolfKillSelf';
                        },
                        disable: false,
                        html: 'ç‹¼äººè‡ªçˆ†',
                        isShow: !(_this.stage == 'voting' || _this.stage == 'usingSkill')
                    }, {
                        class: 'function-btn special',
                        click: _this.pkRound,
                        disable: false,
                        html: _this.today.PKRoundNum == 0 ? 'ç¥¨æ•¸ç›¸åŒ é€²è¡Œè¾¯è«–' : 'ç¥¨æ•¸å†æ¬¡ç›¸åŒ é€²å…¥é»‘å¤œ',
                        isShow: _this.stage == 'voting',
                    }, {
                        class: 'function-btn special',
                        click: () => {
                            _this.passSkillFlag = true;
                            _this.next();
                        },
                        disable: false,
                        html: 'ä¸ä½¿ç”¨æŠ€èƒ½',
                        isShow: _this.stage == 'usingSkill'
                    }
                ];
            },
        }
    })
</script>